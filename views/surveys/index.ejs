<%- include('../partials/header', { title: 'Surveys', user: user }) %>

<div class="page-header">
  <div class="container">
    <h1><i class="bi bi-clipboard-data-fill"></i> Surveys</h1>
    <p>View and analyze participant feedback surveys</p>
  </div>
</div>

<div class="container">
  <div class="card">
    <% if (user && user.role === 'admin') { %>
    <div class="mb-3">
      <a href="/surveys/new" class="btn btn-success">
        <i class="bi bi-plus-circle-fill"></i> Add New Survey
      </a>
    </div>
    <% } %>

    <div class="table-responsive">
      <table class="table">
        <thead>
          <tr>
            <th>
              <a href="?sortBy=surveysatisfactionscore&sortOrder=<%= sortBy === 'surveysatisfactionscore' && sortOrder === 'asc' ? 'desc' : 'asc' %>" style="color: inherit; text-decoration: none; cursor: pointer; white-space: nowrap;">
                Satisfaction
                <% if (sortBy === 'surveysatisfactionscore') { %>
                  <i class="bi bi-arrow-<%= sortOrder === 'asc' ? 'up' : 'down' %>"></i>
                <% } else { %>
                  <i class="bi bi-arrow-down-up" style="opacity: 0.3; font-size: 0.8em;"></i>
                <% } %>
              </a>
            </th>
            <th>
              <a href="?sortBy=surveyusefulnessscore&sortOrder=<%= sortBy === 'surveyusefulnessscore' && sortOrder === 'asc' ? 'desc' : 'asc' %>" style="color: inherit; text-decoration: none; cursor: pointer; white-space: nowrap;">
                Usefulness
                <% if (sortBy === 'surveyusefulnessscore') { %>
                  <i class="bi bi-arrow-<%= sortOrder === 'asc' ? 'up' : 'down' %>"></i>
                <% } else { %>
                  <i class="bi bi-arrow-down-up" style="opacity: 0.3; font-size: 0.8em;"></i>
                <% } %>
              </a>
            </th>
            <th>
              <a href="?sortBy=surveyinstructorscore&sortOrder=<%= sortBy === 'surveyinstructorscore' && sortOrder === 'asc' ? 'desc' : 'asc' %>" style="color: inherit; text-decoration: none; cursor: pointer; white-space: nowrap;">
                Instructor
                <% if (sortBy === 'surveyinstructorscore') { %>
                  <i class="bi bi-arrow-<%= sortOrder === 'asc' ? 'up' : 'down' %>"></i>
                <% } else { %>
                  <i class="bi bi-arrow-down-up" style="opacity: 0.3; font-size: 0.8em;"></i>
                <% } %>
              </a>
            </th>
            <th>
              <a href="?sortBy=surveyrecommendationscore&sortOrder=<%= sortBy === 'surveyrecommendationscore' && sortOrder === 'asc' ? 'desc' : 'asc' %>" style="color: inherit; text-decoration: none; cursor: pointer; white-space: nowrap;">
                Recommendation
                <% if (sortBy === 'surveyrecommendationscore') { %>
                  <i class="bi bi-arrow-<%= sortOrder === 'asc' ? 'up' : 'down' %>"></i>
                <% } else { %>
                  <i class="bi bi-arrow-down-up" style="opacity: 0.3; font-size: 0.8em;"></i>
                <% } %>
              </a>
            </th>
            <th>
              <a href="?sortBy=surveyoverallscore&sortOrder=<%= sortBy === 'surveyoverallscore' && sortOrder === 'asc' ? 'desc' : 'asc' %>" style="color: inherit; text-decoration: none; cursor: pointer; white-space: nowrap;">
                Overall
                <% if (sortBy === 'surveyoverallscore') { %>
                  <i class="bi bi-arrow-<%= sortOrder === 'asc' ? 'up' : 'down' %>"></i>
                <% } else { %>
                  <i class="bi bi-arrow-down-up" style="opacity: 0.3; font-size: 0.8em;"></i>
                <% } %>
              </a>
            </th>
            <th>
              <a href="?sortBy=surveysubmissiondate&sortOrder=<%= sortBy === 'surveysubmissiondate' && sortOrder === 'asc' ? 'desc' : 'asc' %>" style="color: inherit; text-decoration: none; cursor: pointer; white-space: nowrap;">
                Submission Date
                <% if (sortBy === 'surveysubmissiondate') { %>
                  <i class="bi bi-arrow-<%= sortOrder === 'asc' ? 'up' : 'down' %>"></i>
                <% } else { %>
                  <i class="bi bi-arrow-down-up" style="opacity: 0.3; font-size: 0.8em;"></i>
                <% } %>
              </a>
            </th>
            <th>
              <a href="?sortBy=registrationid&sortOrder=<%= sortBy === 'registrationid' && sortOrder === 'asc' ? 'desc' : 'asc' %>" style="color: inherit; text-decoration: none; cursor: pointer; white-space: nowrap;">
                Registration ID
                <% if (sortBy === 'registrationid') { %>
                  <i class="bi bi-arrow-<%= sortOrder === 'asc' ? 'up' : 'down' %>"></i>
                <% } else { %>
                  <i class="bi bi-arrow-down-up" style="opacity: 0.3; font-size: 0.8em;"></i>
                <% } %>
              </a>
            </th>
            <% if (user && user.role === 'admin') { %>
            <th>Actions</th>
            <% } %>
          </tr>
        </thead>
        <tbody>
          <% surveys.forEach(s => { %>
          <tr>
            <td>
              <span class="badge bg-success"
                ><%= s.surveysatisfactionscore || '—' %></span
              >
            </td>
            <td>
              <span class="badge bg-success"
                ><%= s.surveyusefulnessscore || '—' %></span
              >
            </td>
            <td>
              <span class="badge bg-success"
                ><%= s.surveyinstructorscore || '—' %></span
              >
            </td>
            <td>
              <span class="badge bg-success"
                ><%= s.surveyrecommendationscore || '—' %></span
              >
            </td>
            <td>
              <strong><%= s.surveyoverallscore || '—' %></strong>
            </td>
            <td>
              <% if (s.surveysubmissiondate) { %>
                <%= new Date(s.surveysubmissiondate).toLocaleString('en-US', {
                  year: 'numeric',
                  month: 'short',
                  day: 'numeric',
                  hour: '2-digit',
                  minute: '2-digit'
                }) %>
              <% } else { %>
                —
              <% } %>
            </td>
            <td><%= s.registrationid || '—' %></td>
            <% if (user && user.role === 'admin') { %>
            <td>
              <a href="/surveys/<%= s.surveyid %>" class="btn btn-sm btn-info">
                <i class="bi bi-eye-fill"></i> View
              </a>
            </td>
            <% } %>
          </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
  </div>
</div>

<%- include('../partials/footer-scripts') %>
